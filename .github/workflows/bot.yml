name: TRON Lottery Bot

on:
  push:
    branches: [ main ]
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'  # هر 6 ساعت یکبار ریستارت

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        
    - name: Create data directories
      run: |
        mkdir -p data backups exports logs
        
    - name: Run TRON Lottery Bot
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
        ADMIN_IDS: ${{ secrets.ADMIN_IDS }}
        BUSINESS_TRON_ADDRESS: ${{ secrets.BUSINESS_TRON_ADDRESS }}
        TRONSCAN_API_KEY: ${{ secrets.TRONSCAN_API_KEY }}
      run: |
        # جایگزینی متغیرهای محیطی در کد
        sed -i "s/توکن_ربات_خودت_را_اینجا_قرار_ده/$BOT_TOKEN/g" bot.py
        sed -i "s/123456789/$ADMIN_IDS/g" bot.py
        sed -i "s/TAXB65Gnizfuc486FqycEi3F4Eyg1ArPqN/$BUSINESS_TRON_ADDRESS/g" bot.py
        sed -i "s/کلید_api_خودت_را_اینجا_قرار_ده/$TRONSCAN_API_KEY/g" bot.py
        
        # اجرای ربات
        python bot.py &
        sleep 300  # 5 دقیقه اجرا شود
        # ربات به صورت مداوم اجرا می‌شود
